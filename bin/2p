#!/usr/bin/env bash
set -euo pipefail

# 2p: 2ペイン構成で tmux セッションを生成する
# 左ペイン: yazi  右ペイン: claude

SESSION_NAME="${1:-$(basename "$PWD")}"
PROJECT_ROOT="${2:-$PWD}"

LAYOUT='657d,183x51,0,0{106x51,0,0,0,76x51,107,0,2}'

attach_or_switch() {
  if [ -n "${TMUX:-}" ]; then
    tmux switch-client -t "$SESSION_NAME"
  else
    tmux attach-session -t "$SESSION_NAME"
  fi
}

if tmux has-session -t "$SESSION_NAME" 2>/dev/null; then
  attach_or_switch
  exit 0
fi

tmux new-session -d -s "$SESSION_NAME" -c "$PROJECT_ROOT" "yazi"
tmux split-window -h -t "$SESSION_NAME" -c "$PROJECT_ROOT" "claude"
tmux select-layout -t "$SESSION_NAME" "$LAYOUT" 2>/dev/null || true
attach_or_switch
